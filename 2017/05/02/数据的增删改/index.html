<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>数据的增删改 · Nancelglap</title><meta name="description" content="数据的增删改 - Nancelglap"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="stylesheet" href="https://highlightjs.org/static/demo/styles/solarized-light.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Nancelglap"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="http://wx3.sinaimg.cn/mw1024/8a2125c3gy1fgpv7wi9alj20qo0qo0xr.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">数据的增删改</h1><div class="tags"><a href="/tags/laravel/" class="tag-title">#laravel</a><a href="/tags/Controller/" class="tag-title">#Controller</a></div><div class="post-info">2017年5月2日</div><div class="post-content"><blockquote>
<p>Controller中 store, destory, update方法</p>
</blockquote>
<a id="more"></a>
<h2 id="1、增–store"><a href="#1、增–store" class="headerlink" title="1、增–store"></a><strong>1、增–store</strong></h2><p><code>这里省去验证和文件上传步骤，详见laravel文件上传</code><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">modelName</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(newRequest $request)</span></span></div><div class="line">&#123;</div><div class="line">    $content = $request-&gt;except(<span class="string">'_token'</span>, <span class="string">'fileName'</span>);  <span class="comment">//不包括token和文件上传</span></div><div class="line">    $content[<span class="string">'filename'</span>] = <span class="string">'URL'</span> . <span class="string">'newFilename'</span> . $file-&gt;getClientOriginalExtension();</div><div class="line">    modelName::create($content);</div><div class="line"></div><div class="line">    redirect(<span class="string">'/path'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="2、删–destory"><a href="#2、删–destory" class="headerlink" title="2、删–destory"></a><strong>2、删–destory</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">modelName</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">File</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destory</span><span class="params">($id)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//先通过用户验证，进入相应用户的删除操作界面</span></div><div class="line">    <span class="keyword">$this</span> -&gt; middleware(<span class="string">'auth'</span>);</div><div class="line"></div><div class="line">    $content = modelName::find($id);</div><div class="line"></div><div class="line">    <span class="comment">//要删除的文件，引入File Facade</span></div><div class="line">    File::delete(<span class="string">'/path/fileName'</span>);</div><div class="line"></div><div class="line">    <span class="comment">//删除数据库数据</span></div><div class="line">    $content -&gt; delete();</div><div class="line">    redirect(<span class="string">'/path'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="3、改–update"><a href="#3、改–update" class="headerlink" title="3、改–update"></a><strong>3、改–update</strong></h2><p><strong>改有两种方法可用，一种为直接新内容覆盖旧内容，另一种为逐条信息更新再update</strong></p>
<blockquote>
<p>第一种：覆盖</p>
</blockquote>
<p><strong>先不取出上传文件，后面处理后再加入数组，以下省略文件验证代码，详见<a href="">larval文件上传</a></strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">modelName</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">File</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(newRquest $request, $id)</span></span></div><div class="line">&#123;</div><div class="line">    $new_data = $request-&gt;except(<span class="string">'_token'</span>, <span class="string">'filename'</span>);</div><div class="line">    $file = $request -&gt; file(<span class="string">'filename'</span>);</div><div class="line">    $file -&gt; move(<span class="string">'/path'</span>, <span class="string">'fileNewName.extension'</span>);</div><div class="line">    File::delete(<span class="string">'/path/fileName'</span>);</div><div class="line"></div><div class="line">    $raw_data = modelName::findOrFail($id);</div><div class="line">    $raw_data -&gt; update($new_data);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>第二种：逐条更新</p>
</blockquote>
<p><strong>缺点：要先在Controller中写好包含每列名称的关联数组</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">modelName</span>;</div><div class="line"><span class="keyword">protected</span> $column_names = [</div><div class="line">    <span class="string">'column_name1'</span> =&gt; <span class="string">''</span>,</div><div class="line">    <span class="string">'column_name2'</span> =&gt; <span class="string">''</span>,</div><div class="line">    <span class="string">'column_name3'</span> =&gt; <span class="string">''</span>,</div><div class="line">    <span class="string">'column_name4'</span> =&gt; <span class="string">''</span>,</div><div class="line"></div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">(newRequest $request, $id)</span></span></div><div class="line">&#123;</div><div class="line">    $raw_data = modelName::findOrFail($id);</div><div class="line"></div><div class="line">    <span class="comment">//取出键名</span></div><div class="line">    <span class="keyword">foreach</span>(array_keys(array_except(<span class="keyword">$this</span>-&gt;column_names, [<span class="string">'column_namex'</span>])) <span class="keyword">as</span> $key)</div><div class="line">    &#123;</div><div class="line">        $raw_data-&gt;$key = $request-&gt;get($key);</div><div class="line">    &#125;</div><div class="line">    $raw_data -&gt; save();</div><div class="line"></div><div class="line">    redirect(<span class="string">'/path'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/05/02/Eloquent-关系/" class="prev">上一篇</a><a href="/2017/05/06/创建token/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 <a href="http://yoursite.com">Nancelglap</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a>.</p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" crossorigin="anonymous"></script><script src="//cdn.bootcss.com/jquery/3.1.1/jquery.js" crossorigin="anonymous"></script><script>$(document).ready(function() { $('pre').each(function(i, block) { hljs.highlightBlock(block); }); });</script></body></html>